<!DOCTYPE html>
<!-- saved from url=(0058)http://127.0.0.1:3999/dependency-injection+mocking.slide#1 -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Dependency Injection and Mocking</title>
    
    <script>
      var notesEnabled =  false ;
    </script>
    <script src="./Dependency Injection and Mocking_files/slides.js"></script>

    

    <script>
      
      if (window["location"] && window["location"]["hostname"] == "talks.golang.org") {
        var _gaq = _gaq || [];
        _gaq.push(["_setAccount", "UA-11222381-6"]);
        _gaq.push(["b._setAccount", "UA-49880327-6"]);
        window.trackPageview = function() {
          _gaq.push(["_trackPageview", location.pathname+location.hash]);
          _gaq.push(["b._trackPageview", location.pathname+location.hash]);
        };
        window.trackPageview();
        window.trackEvent = function(category, action, opt_label, opt_value, opt_noninteraction) {
          _gaq.push(["_trackEvent", category, action, opt_label, opt_value, opt_noninteraction]);
          _gaq.push(["b._trackEvent", category, action, opt_label, opt_value, opt_noninteraction]);
        };
      }
    </script>
  <meta name="viewport" content="width=device-width,height=device-height,initial-scale=1"><meta name="apple-mobile-web-app-capable" content="yes"></head>

  <body style="display: none" class="loaded">

    <section class="slides layout-widescreen">

      <article class="current">
        <h1>Dependency Injection and Mocking</h1>
        <h3>Tools for writing maintainable, testable code</h3>
        <h3>3 July 2018</h3>
        
          <div class="presenter">
            
  
  <p>
    Jacob H. Haven
  </p>
  

          </div>
        
      </article>

  
  
      <article class="next">
      
        <h3>What is Dependency Injection?</h3>
        
  
  <p>
    Applying service-oriented architecture to writing code.
  </p>
  

  <ul>
  
    <li>Each "service" is an object providing a set of functions to its "clients".</li>
  
    <li>Services are black boxed, with only their outward interfaces known to their clients.</li>
  
    <li>Clients are initialized with the set of services they depend on instead of creating those dependencies themselves.</li>
  
  </ul>

      
      <span class="pagenumber">2</span>
      </article>
  
  
  
      <article class="far-next">
      
        <h3>Why is Dependency Injection?</h3>
        
  <ul>
  
    <li>Reduces system complexity by seperating service implementations from where they're used</li>
  
    <li>Client only need to / can know the outward interface of a service, not what's going on under the hood.</li>
  
    <li>A service can be replaced with new service satisfying the same interface, without affecting clients.</li>
  
  </ul>

      
      <span class="pagenumber">3</span>
      </article>
  
  
  
      <article>
      
        <h3>Where is Dependency Injection?</h3>
        
  
  <p>
    Everywhere! Our code base is very modular, with functions grouped into services and exposed through interfaces used by various clients.
  </p>
  

      
      <span class="pagenumber">4</span>
      </article>
  
  
  
      <article>
      
        <h3>What is Mocking?</h3>
        
<div class="image">
  <img src="./Dependency Injection and Mocking_files/mockingbird.jpg" width="300">
</div>

  
  <p>
    Mocking is the act of implementing a service's interface with a "dummy" implementation and then injecting that dependency into the client you're interested in. It can be very useful for unit testing, as it allows you to test a component in isolation, without worrying about the behaviors and initialization of all its dependecies.
  </p>
  

      
      <span class="pagenumber">5</span>
      </article>
  
  
  
      <article>
      
        <h3>Custom Mocks</h3>
        
  
  <p>
    The simplest way to mock a service is to create a hand-crafted object that implements its interface, inject it into the component your testing.
  </p>
  

  <ul>
  
    <li>Very flexible testing, as you can define the behavior of your mock the same as any other service.</li>
  
    <li>Time consuming, as you have to write a full mock for each dependency.</li>
  
    <li>Custom mocks are often inconsitent with each other in their behavior, as they are often only written to satisfy a one-off testcase.</li>
  
  </ul>

      
      <span class="pagenumber">6</span>
      </article>
  
  
  
      <article>
      
        <h3>Autogenerated Mocks</h3>
        
  
  <p>
    There are tools, such as gomock to generate code that satisfies a known service interface.
  </p>
  
<p class="link"><a href="https://github.com/golang/mock" target="_blank">gomock</a></p>
  <ul>
  
    <li>These have rigid, consistent implementations that allow the writing of consistent tests.</li>
  
    <li>Built to be as generic as possible to satisfy the most use-cases</li>
  
    <li>Many built-in features to make writing tests easier.</li>
  
  </ul>

      
      <span class="pagenumber">7</span>
      </article>
  
  
  
      <article>
      
        <h3>Example Service</h3>
        
  <div class="code">


<pre><span num="1">package db</span>
<span num="2"></span>
<span num="3">// User represents a simple user.</span>
<span num="4">type User struct {</span>
<span num="5">    ID          uint</span>
<span num="6">    Name, Email string</span>
<span num="7">}</span>
<span num="8"></span>
<span num="9">// UserStore is a store for getting and creating Users.</span>
<span num="10">type UserStore interface {</span>
<span num="11">    Get(id uint) (*User, error)</span>
<span num="12">    Create(name, email string) *User</span>
<span num="13">}</span>
</pre>


</div>

      
      <span class="pagenumber">8</span>
      </article>
  
  
  
      <article>
      
        <h3>Example Test</h3>
        
  <div class="code">


<pre><span num="13">func TestUserStore(t *testing.T) {</span>
<span num="14">    mockCtrl := gomock.NewController(t)</span>
<span num="15">    defer mockCtrl.Finish()</span>
<span num="16">    var (</span>
<span num="17">        userID    uint = 1</span>
<span num="18">        userName       = "Malcolm Reynolds"</span>
<span num="19">        userEmail      = "capn.mal@example.com"</span>
<span num="20">        user           = &amp;db.User{userID, userName, userEmail}</span>
<span num="21">    )</span>
<span num="22">    store := mocks.NewMockUserStore(mockCtrl)</span>
<span num="23">    gomock.InOrder(</span>
<span num="24">        store.EXPECT().Create(userName, userEmail).Return(user),</span>
<span num="25">        store.EXPECT().Get(userID).Return(user, nil),</span>
<span num="26">    )</span>
<span num="27"></span>
<span num="28">    createdUser := store.Create(userName, userEmail)</span>
<span num="29">    require.Equal(t, userName, createdUser.Name)</span>
<span num="30">    require.Equal(t, userEmail, createdUser.Email)</span>
<span num="31">    require.Equal(t, userID, createdUser.ID)</span>
<span num="32"></span>
<span num="33">    gotUser, err := store.Get(createdUser.ID)</span>
<span num="34">    require.NoError(t, err)</span>
<span num="35">    require.Equal(t, createdUser, gotUser)</span>
<span num="36">}</span>
</pre>


</div>

      
      <span class="pagenumber">9</span>
      </article>
  
  

      <article>
        <h3>Thank you</h3>
        
          <div class="presenter">
            
  
  <p>
    Jacob H. Haven
  </p>
  
<p class="link"><a href="mailto:jacob@jhaven.me" target="_blank">jacob@jhaven.me</a></p>
          </div>
        
      </article>

    <div class="slide-area" id="prev-slide-area"></div><div class="slide-area" id="next-slide-area"></div></section>

    <div id="help" style="display: none;">
      Use the left and right arrow keys or click the left and right
      edges of the page to navigate between slides.<br>
      (Press 'H' or navigate to hide this message.)
    </div>

    
    <script src="./Dependency Injection and Mocking_files/play.js"></script>
    

    <script>
      (function() {
        
        if (window["location"] && window["location"]["hostname"] == "talks.golang.org") {
          var ga = document.createElement("script"); ga.type = "text/javascript"; ga.async = true;
          ga.src = ("https:" == document.location.protocol ? "https://ssl" : "http://www") + ".google-analytics.com/ga.js";
          var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(ga, s);
        }
      })();
    </script>
  

<link rel="stylesheet" type="text/css" href="./Dependency Injection and Mocking_files/css"><link rel="stylesheet" type="text/css" href="./Dependency Injection and Mocking_files/styles.css"></body></html>